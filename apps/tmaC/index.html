<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Calculadora de TMA</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 140px; margin-bottom: 10px; font-size: 16px; }
    .result { font-size: 18px; margin-top: 15px; }
    .label { font-weight: bold; margin-top: 10px; display: block; }
    .inputRow { margin-bottom: 10px; }
</style>
</head>

<body>
<h2>Calculadora de TMA</h2>

<label class="label">Tempos (MM.SS):</label>
<textarea id="inputArea" placeholder="Ex: 13.50&#10;12.05&#10;11&#10;14.30"></textarea>

<button onclick="calcular()">Calcular TMA</button>

<div class="result">
    <div><b>Total (min):</b> <span id="totalMin">0</span></div>
    <div><b>Total (seg):</b> <span id="totalSec">0</span></div>
    <div><b>Quantidade:</b> <span id="qtd">0</span></div>
    <div><b>TMA (min):</b> <span id="tmaMin">0</span></div>
    <div><b>TMA (seg):</b> <span id="tmaSec">0</span></div>
</div>

<script>
// -----------------------------------------------------
//  VALIDAR FORMATO MM.SS  (nova lógica)
// -----------------------------------------------------
function validarMMSS(valorStr) {
    if (!/^\d+(\.\d{1,2})?$/.test(valorStr)) return false;

    if (!valorStr.includes(".")) return true;

    const [minStr, secStr] = valorStr.split(".");
    const segundos = parseInt(secStr, 10);

    if (secStr.length !== 2) return false; // Tem de ser 2 dígitos
    if (segundos > 59) return false;       // Máximo 59 segundos

    return true;
}

// -----------------------------------------------------
//  PARSE + CONVERSÃO PARA MINUTOS DECIMAIS
// -----------------------------------------------------
function parseInput(text) {
    if (!text) return [];

    const raw = text
        .split(/[\n,;]+/)
        .map((s) => s.trim())
        .filter(Boolean);

    const values = [];
    const invalids = [];

    raw.forEach((chunk) => {
        const parts = chunk.split(/\s+/).filter(Boolean);

        parts.forEach((p) => {
            let cleaned = p
                .replace(/min(?:ute)?s?/i, "")
                .replace(/m\b/i, "")
                .replace(/,/g, ".")
                .replace(/[^0-9.]/g, "");

            if (cleaned === "") return;

            // validar formato MM.SS
            if (!validarMMSS(cleaned)) {
                invalids.push(cleaned);
                return;
            }

            // Converter para decimal corretamente
            if (cleaned.includes(".")) {
                const [mStr, sStr] = cleaned.split(".");
                const minutos = parseInt(mStr, 10);
                const segundos = parseInt(sStr, 10);

                const totalDecimal = minutos + segundos / 60;
                values.push(totalDecimal);
            } else {
                values.push(Number(cleaned));
            }
        });
    });

    if (invalids.length > 0) {
        alert("Valores inválidos (MM.SS): " + invalids.join(", "));
    }

    return values;
}

// -----------------------------------------------------
//  CALCULAR TMA
// -----------------------------------------------------
function calcular() {
    const input = document.getElementById("inputArea").value;
    const valores = parseInput(input);

    if (valores.length === 0) {
        document.getElementById("totalMin").innerText = "0";
        document.getElementById("totalSec").innerText = "0";
        document.getElementById("qtd").innerText = "0";
        document.getElementById("tmaMin").innerText = "0";
        document.getElementById("tmaSec").innerText = "0";
        return;
    }

    const soma = valores.reduce((a, b) => a + b, 0);
    const quantidade = valores.length;

    // Conversões
    const somaSegundos = Math.round(soma * 60);
    const tmaDecimal = soma / quantidade;
    const tmaSegundos = Math.round(tmaDecimal * 60);

    const tmaMin = Math.floor(tmaSegundos / 60);
    const tmaSec = tmaSegundos % 60;

    // Atualizar UI
    document.getElementById("totalMin").innerText = soma.toFixed(2);
    document.getElementById("totalSec").innerText = somaSegundos;
    document.getElementById("qtd").innerText = quantidade;
    document.getElementById("tmaMin").innerText = tmaMin;
    document.getElementById("tmaSec").innerText = tmaSec.toString().padStart(2, "0");
}

// -----------------------------------------------------
</script>
</body>
</html>
