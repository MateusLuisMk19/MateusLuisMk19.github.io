<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pro Player ‚Äî Background</title>
<style>
  :root {
    --primary: #00c8ff;
    --bg-dark: rgba(10, 10, 10, 0.95);
    --glass: rgba(255, 255, 255, 0.1);
  }

  body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }

  #player {
    position: fixed;
    inset: 0;
    z-index: -2;
    pointer-events: none;
    background: #000;
  }

  .ui {
    position: fixed;
    inset: 0;
    z-index: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end; /* Controles na parte inferior como Spotify/YT Music */
    background: linear-gradient(to bottom, transparent 40%, var(--bg-dark) 100%);
    pointer-events: none;
  }

  .controls {
    width: 100%;
    padding: 20px 0;
    pointer-events: auto;
  }

  /* Informa√ß√£o da Faixa */
  .track-info {
    text-align: center;
    color: #fff;
    margin-bottom: 20px;
    padding: 0 20px;
  }
  .track-title { font-size: 1.2rem; font-weight: bold; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .top-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    margin-bottom: 15px;
  }

  .btn {
    background: var(--glass);
    border: 1px solid rgba(255,255,255,0.1);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    color: #fff;
    font-size: 20px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn:hover { background: rgba(255,255,255,0.2); }
  .btn:active { transform: scale(0.9); }
  .btn.active { color: var(--primary); border-color: var(--primary); }
  #playPauseBtn { width: 65px; height: 65px; background: #fff; color: #000; font-size: 24px; }

  .progress-container {
    padding: 0 30px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .progress {
    flex-grow: 1;
    height: 6px;
    background: rgba(255,255,255,0.2);
    border-radius: 10px;
    cursor: pointer;
    position: relative;
  }

  .bar {
    height: 100%;
    background: var(--primary);
    width: 0%;
    border-radius: 10px;
    position: relative;
  }

  .time { color: #aaa; font-size: 12px; min-width: 45px; }

  .bottom-row {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px 30px;
    gap: 15px;
  }

  input[type="range"] { cursor: pointer; accent-color: var(--primary); }

  #adOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    color: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
    font-weight: bold;
    font-size: 1.5rem;
  }
</style>
</head>
<body>

<div id="player"></div>

<div id="adOverlay">PULANDO AN√öNCIO...</div>

<div class="ui">
  <div class="track-info">
    <p class="track-title" id="trackTitle">A carregar playlist...</p>
  </div>

  <div class="controls">
    <div class="top-row">
      <button class="btn" id="shuffleBtn">üîÄ</button>
      <button class="btn" id="prevBtn">‚èÆ</button>
      <button class="btn" id="playPauseBtn">‚ñ∂</button>
      <button class="btn" id="nextBtn">‚è≠</button>
      <button class="btn" id="loopBtn">üîÅ</button>
    </div>

    <div class="progress-container">
      <span class="time" id="curTime">0:00</span>
      <div class="progress" id="progress">
        <div class="bar" id="progressBar"></div>
      </div>
      <span class="time" id="durTime">0:00</span>
    </div>

    <div class="bottom-row">
      <button class="btn" id="muteBtn" style="width:40px;height:40px;font-size:16px">üîä</button>
      <input id="vol" type="range" min="0" max="100" value="100">
    </div>
  </div>
</div>

<script>
  const PLAYLIST_ID = 'PLaF8FbChcxg6wfsLJqVkrD19oqKdvmv7I';
  let player, updateTimer;
  let isMuted = true;
  let isShuffle = true;
  let isLoop = true;

  // Carregar API
  let tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '100%', width: '100%',
      playerVars: {
        listType: 'playlist', list: PLAYLIST_ID,
        autoplay: 1, controls: 0, disablekb: 1, rel: 0, mute: 1
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    player.setShuffle(isShuffle);
    player.setLoop(isLoop);
    updateUIStates();
    startLoop();
  }

  function onPlayerStateChange(e) {
    const btn = document.getElementById('playPauseBtn');
    const title = document.getElementById('trackTitle');
    
    if (e.data === YT.PlayerState.PLAYING) {
      btn.innerHTML = '‚è∏';
      const videoData = player.getVideoData();
      title.innerText = videoData.title;
    } else {
      btn.innerHTML = '‚ñ∂';
    }

    if (e.data === YT.PlayerState.ENDED && isLoop && !isShuffle) {
        // Fallback manual para loop se a API falhar
        player.playVideoAt(player.getPlaylistIndex());
    }
  }

  function startLoop() {
    setInterval(() => {
      if (!player || !player.getCurrentTime) return;

      // Ad Skip Logic
      const ad = document.getElementById("adOverlay");
      const isAd = player.getAdState && (player.getAdState() > 0);
      
      if (isAd) {
        ad.style.opacity = "1";
        player.seekTo(player.getDuration(), true);
      } else {
        ad.style.opacity = "0";
      }

      // Update Progress
      const cur = player.getCurrentTime();
      const dur = player.getDuration();
      if (dur > 0) {
        const pct = (cur / dur) * 100;
        document.getElementById('progressBar').style.width = pct + '%';
        document.getElementById('curTime').innerText = formatTime(cur);
        document.getElementById('durTime').innerText = formatTime(dur);
      }
    }, 500);
  }

  // Event Listeners
  document.getElementById('playPauseBtn').onclick = () => {
    player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
  };

  document.getElementById('nextBtn').onclick = () => player.nextVideo();
  document.getElementById('prevBtn').onclick = () => player.previousVideo();

  document.getElementById('shuffleBtn').onclick = () => {
    isShuffle = !isShuffle;
    player.setShuffle(isShuffle);
    updateUIStates();
  };

  document.getElementById('loopBtn').onclick = () => {
    isLoop = !isLoop;
    player.setLoop(isLoop);
    updateUIStates();
  };

  document.getElementById('vol').oninput = (e) => {
    player.setVolume(e.target.value);
    player.unMute();
    document.getElementById('muteBtn').innerText = e.target.value > 0 ? 'üîä' : 'üîá';
  };

  document.getElementById('progress').onclick = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const pct = (e.clientX - rect.left) / rect.width;
    player.seekTo(player.getDuration() * pct, true);
  };

  function updateUIStates() {
    document.getElementById('shuffleBtn').classList.toggle('active', isShuffle);
    document.getElementById('loopBtn').classList.toggle('active', isLoop);
  }

  function formatTime(s) {
    let m = Math.floor(s / 60);
    s = Math.floor(s % 60);
    return m + ":" + (s < 10 ? '0' + s : s);
  }

  // Ativa √°udio no primeiro clique (restri√ß√£o do browser)
  document.body.onclick = () => {
    if (player && isMuted) {
        player.unMute();
        player.setVolume(50);
        document.getElementById('vol').value = 50;
        isMuted = false;
    }
  };
</script>
</body>
</html>
